<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nerium L.</title>
    <!-- Add Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Source+Sans+Pro:wght@300;400&display=swap');
        
        :root {
            --primary-green: #2E5E2A;
            --secondary-green: #5A8C45;
            --accent-gold: #B38E3D;
            --light-bg: #F8F9F7;
            --border-gray: #DEE2E6;
            --mother-border: #8B5A2B;
            
            /* IUCN Colors */
            --iucn-ex: #000000;
            --iucn-ew: #cc33ff;
            --iucn-cr: #ff3333;
            --iucn-en: #ff9933;
            --iucn-vu: #ffff33;
            --iucn-nt: #99cc33;
            --iucn-lc: #33cc33;
            --iucn-dd: #cccccc;
            --iucn-ne: #777777;
            --iucn-end: #ff3333; /* Endemic color */
            
            /* Granddaughter colors */
            --granddaughter-1: #E1F5FE;
            --granddaughter-2: #E8F5E9;
            --granddaughter-3: #FFF8E1;
            --granddaughter-4: #F3E5F5;
            --granddaughter-5: #FFEBEE;
            --granddaughter-border-1: #4FC3F7;
            --granddaughter-border-2: #81C784;
            --granddaughter-border-3: #FFD54F;
            --granddaughter-border-4: #BA68C8;
            --granddaughter-border-5: #EF5350;
        }
        
        body {
            font-family: 'Source Sans Pro', sans-serif;
            background-color: var(--light-bg);
            color: #212529;
            margin: 0;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .header-title {
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
        }
        .header-title:hover {
            text-decoration: underline;
        }
        
        .systematic-container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
        }
        
        h1 {
            font-family: 'Libre Baskerville', serif;
            font-size: 2.8rem;
            text-align: center;
            color: var(--primary-green);
            margin-bottom: 50px;
            position: relative;
            padding-bottom: 15px;
        }
        
        h1::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
        }
        
        /* Mother Box - Distinct Style */
        .genus-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--mother-border);
            padding: 35px;
            margin: 0 auto 50px;
            width: 85%;
            position: relative;
            transition: transform 0.3s;
        }
        
        .genus-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        /* Daughter Boxes - Distinct Style */
        .species-card {
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid var(--secondary-green);
            padding: 25px;
            margin-left: 10%;
            margin-bottom: 30px;
            width: 80%;
            position: relative;
            transition: all 0.3s;
        }
        
        .species-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        /* Granddaughter Boxes - Distinct Style */
        .subspecies-card {
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            padding: 20px;
            margin-left: 15%;
            margin-bottom: 20px;
            width: 80%;
            position: relative;
            transition: all 0.3s;
        }
        
        .subspecies-card.type-1 {
            background-color: var(--granddaughter-1);
            border-left: 4px solid var(--granddaughter-border-1);
        }
        
        .subspecies-card.type-2 {
            background-color: var(--granddaughter-2);
            border-left: 4px solid var(--granddaughter-border-2);
        }
        
        .subspecies-card.type-3 {
            background-color: var(--granddaughter-3);
            border-left: 4px solid var(--granddaughter-border-3);
        }
        
        .subspecies-card.type-4 {
            background-color: var(--granddaughter-4);
            border-left: 4px solid var(--granddaughter-border-4);
        }
        
        .subspecies-card.type-5 {
            background-color: var(--granddaughter-5);
            border-left: 4px solid var(--granddaughter-border-5);
        }
        
        .subspecies-card:hover {
            transform: translateX(3px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .taxon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
        }
        
        .genus-card .taxon-header {
            border-bottom: 1px solid var(--mother-border);
        }
        
        .species-card .taxon-header {
            border-bottom: 1px dashed var(--border-gray);
        }
        
        .subspecies-card .taxon-header {
            border-bottom: 1px dotted var(--border-gray);
        }
        
        .taxon-title {
            font-family: 'Libre Baskerville', serif;
            color: var(--primary-green);
            margin: 0;
        }
        
        .genus-card .taxon-title {
            font-size: 1.8rem;
        }
        
        .species-card .taxon-title {
            font-size: 1.4rem;
        }
        
        .subspecies-card .taxon-title {
            font-size: 1.1rem;
        }
        
        .taxon-status {
            font-style: italic;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* IUCN Status Colors */
        .status-lc { background-color: var(--iucn-lc); color: #000; }
        .status-nt { background-color: var(--iucn-nt); color: #000; }
        .status-vu { background-color: var(--iucn-vu); color: #000; }
        .status-en { background-color: var(--iucn-en); color: #000; }
        .status-cr { background-color: var(--iucn-cr); color: white; }
        .status-ew { background-color: var(--iucn-ew); color: white; }
        .status-ex { background-color: var(--iucn-ex); color: white; }
        .status-dd { background-color: var(--iucn-dd); color: #000; }
        .status-ne { background-color: var(--iucn-ne); color: white; }
        .status-end { 
            background-color: white; 
            color: var(--iucn-end);
            border: 1px solid var(--iucn-end);
        }
        
        /* Economic Status Colors */
        .status-econ-1 { background-color: #5E35B1; color: white; }
        .status-econ-2 { background-color: #3949AB; color: white; }
        
        .taxon-node {
            position: absolute;
            left: -21px;
            top: 40px;
            width: 10px;
            height: 10px;
            background-color: white;
            border: 2px solid var(--secondary-green);
            border-radius: 50%;
            z-index: 2;
        }
        
        .taxon-node::after {
            content: "";
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: var(--secondary-green);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .subspecies-node {
            position: absolute;
            left: -21px;
            top: 30px;
            width: 8px;
            height: 8px;
            background-color: white;
            border: 2px solid var(--secondary-green);
            border-radius: 50%;
            z-index: 2;
        }
        
        .subspecies-node::after {
            content: "";
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: var(--secondary-green);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .view-illustration {
            display: inline-flex;
            align-items: center;
            color: var(--secondary-green);
            font-size: 0.9rem;
            margin-top: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .view-illustration::before {
            content: "\f06e";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        .view-illustration:hover {
            color: var(--primary-green);
            text-decoration: underline;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            overflow: auto;
        }
        
        .modal-content-container {
            margin: auto;
            display: block;
            width: 85%;
            max-width: 800px;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            animation: fadeIn 0.3s;
            text-align: center;
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            display: block;
            margin: 0 auto;
        }
        
        .modal-caption {
            color: white;
            padding: 15px;
            font-size: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            margin-top: 10px;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 15px;
            opacity: 0.7;
            transition: opacity 0.2s;
            z-index: 1001;
        }
        
        .modal-nav:hover {
            opacity: 1;
        }
        
        .modal-nav.prev {
            left: 20px;
        }
        
        .modal-nav.next {
            right: 20px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .close {
            position: absolute;
            top: 30px;
            right: 40px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .close:hover {
            opacity: 1;
        }

        /* Map styles */
        .map-container {
            margin-top: 50px;
        }
        
        .map-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 2rem;
            text-align: center;
            color: var(--primary-green);
            margin-bottom: 20px;
        }
        
        #distributionMap {
            height: 500px;
            width: 90%;
            margin: 0 auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--mother-border);
        }
        
        .map-label {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
            pointer-events: none;
            transform: translate(15px, -50%);
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        /* Collapsible Species Filter Controls */
        .species-filter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 200px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .species-filter-header {
            padding: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary-green);
            color: white;
        }
        
        .species-filter-header h4 {
            margin: 0;
            font-family: 'Libre Baskerville', serif;
            font-size: 0.9rem;
        }
        
        .species-filter-header i {
            transition: transform 0.3s;
        }
        
        .species-filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .species-filter.expanded .species-filter-content {
            max-height: 400px;
            padding: 10px;
            overflow-y: auto;
        }
        
        .species-filter.expanded .species-filter-header i {
            transform: rotate(180deg);
        }
        
        .species-filter-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .species-filter-item input {
            margin-right: 8px;
        }
        
        .species-filter-item label {
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            width: 100%;
        }
        
        .species-filter-item .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: auto;
        }
        
        /* Remark Box */
        .remark-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            border-radius: 8px;
            padding: 30px;
            margin: 50px auto;
            width: 85%;
            position: relative;
            border-left: 5px solid var(--accent-gold);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .remark-box::before {
            content: "\f06a";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            left: 15px;
            top: 15px;
            color: var(--accent-gold);
            font-size: 1.5rem;
            opacity: 0.3;
        }
        
        .remark-title {
            font-family: 'Libre Baskerville', serif;
            color: var(--primary-green);
            margin-top: 0;
            margin-bottom: 15px;
            padding-left: 30px;
            font-size: 1.4rem;
        }
        
        .remark-content {
            padding-left: 30px;
            position: relative;
        }
        
        .remark-content p {
            margin-bottom: 15px;
        }
        
        .remark-content p:last-child {
            margin-bottom: 0;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .genus-card,
            .species-card {
                width: 100%;
                margin-left: 0;
            }
            
            .subspecies-card {
                margin-left: 5%;
                width: 90%;
            }
            
            .taxon-connector,
            .taxon-node,
            .subspecies-node {
                display: none;
            }
            
            #distributionMap {
                width: 100%;
                height: 400px;
            }
            
            .species-filter {
                top: 10px;
                right: 10px;
                width: 160px;
            }
            
            .species-filter.expanded .species-filter-content {
                max-height: 300px;
            }
            
            .remark-box {
                width: 100%;
                padding: 20px;
            }
		.local-name {
  font-style: italic;
  font-size: 0.9em;
  color: #666;
  margin-top: 2px;
}
        }
    </style>
</head>
<body>

<div class="header">
        <div class="header-title" onclick="window.location.href='../index.html'">FlorALG</div>
            </div>

    <div class="systematic-container">
        <h1><i>Nerium</i> L.</h1>
        
        
                <div class="species-card">
            <div class="taxon-connector"></div>
            <div class="taxon-node"></div>
            <div class="taxon-header">
    		<div>
     		 <h2 class="taxon-title"><i>Nerium oleander</i> L.</h2>
      			<div class="local-name">Sp. Pl.: 209 (1753)</div>
			<div class="local-name"><i>Defla, Illili, Elel</i></div>
    			</div>
			<div>
                </div>
                    <span class="taxon-status status-lc">LC</span>
            </div>

            <p>Arbuste très glabre à tiges érigées. Feuilles coriaces entières 4-10 x 2-3 cm. Fleurs grandes 3-4 cm. Calice 5 lobes 2 à 3 fois plus court que le tube de la corolle. Corolle à limbe étalé à gorge munie de 5 écailles multifides opposées aux divisions. Etamines incluses. Fruits à 2 follicules linéaires lancéolés, soudés, longs de 4-8 cm. Graines portant une aigrette de poils.</p>
				<span class="view-illustration" onclick="openModal('morphology', [
            {src: './img/nerol.png', caption: 'Ozenda (2004), p367.'}
        ])">Illustrations</span>
            </div>


        
        <!-- Distribution Map Section -->
        <div class="map-container">
            <h2 class="map-title">Distribution de l'espèce <i>Nerium oleander</i></h2>
            <div id="distributionMap">
                <div class="species-filter">
                    <div class="species-filter-header" onclick="toggleFilterPanel()">
                        <h4>Filtrer les Espèces</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="species-filter-content" id="speciesFilterList"></div>
                </div>
            </div>
        </div>
        
    
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-nav prev" onclick="navigateModal(-1)"><i class="fas fa-chevron-left"></i></div>
        <div class="modal-nav next" onclick="navigateModal(1)"><i class="fas fa-chevron-right"></i></div>
        <div class="modal-content-container">
            <img class="modal-image" id="modalImage">
            <div class="modal-caption" id="modalCaption"></div>
        </div>
    </div>
    
    <!-- Add Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Modal variables
        let currentModalImages = [];
        let currentModalIndex = 0;
        
        // Map variables
        let map;
        let speciesGroups = {}; // To store all markers for each species
        let speciesLabels = {}; // To store all labels for each species
        let speciesColors = {}; // To store color for each species
        
        function openModal(imageName, images = []) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            
            currentModalImages = images;
            currentModalIndex = 0;
            
            modalImg.src = currentModalImages[currentModalIndex].src;
            modalImg.alt = `${imageName} diagram`;
            modalCaption.textContent = currentModalImages[currentModalIndex].caption;
            
            modal.style.display = "block";
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeModal();
                }
            };
        }
        
        function navigateModal(direction) {
            event.stopPropagation();
            currentModalIndex = (currentModalIndex + direction + currentModalImages.length) % currentModalImages.length;
            const modalImg = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            
            modalImg.src = currentModalImages[currentModalIndex].src;
            modalCaption.textContent = currentModalImages[currentModalIndex].caption;
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = "none";
        }
        
        function toggleSpeciesVisibility(speciesId, isChecked) {
            // Toggle all markers for this species
            speciesGroups[speciesId].forEach(marker => {
                marker.setStyle({
                    opacity: isChecked ? 1 : 0,
                    fillOpacity: isChecked ? 0.8 : 0
                });
            });
            
            // Toggle all labels for this species
            speciesLabels[speciesId].forEach(label => {
                label.setOpacity(isChecked ? 1 : 0);
            });
        }
        
        function toggleFilterPanel() {
            const filter = document.querySelector('.species-filter');
            filter.classList.toggle('expanded');
        }
        
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
            } else if (event.key === "ArrowLeft") {
                navigateModal(-1);
            } else if (event.key === "ArrowRight") {
                navigateModal(1);
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.genus-card, .species-card, .subspecies-card');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });
            
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = `all 0.5s ease ${index * 0.1}s`;
                observer.observe(card);
            });

            // Initialize the map
            map = L.map('distributionMap').setView([28.5339, 1.6596], 5);
            
            // Add tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributeurs'
            }).addTo(map);
            
            // Color palette for markers
            const colors = [
                '#2E5E2A', '#5A8C45', '#B38E3D', '#8B5A2B', '#4CA1AF',
                '#2C3E50', '#8E44AD', '#E74C3C', '#3498DB', '#1ABC9C',
                '#D35400', '#27AE60', '#F39C12', '#9B59B6', '#E91E63',
                '#16A085', '#C0392B', '#2980B9', '#F1C40F', '#7F8C8D'
            ];
            
            // Sample data points for Ferula species distribution
            // Each species can have multiple points
            const speciesData = [
                { id: 'nerium', name: "N. oleander", points: [
        { lat: 24.555, lng: 9.48528 },
        { lat: 35.91667, lng: 2.71667 },
        { lat: 36.46667, lng: 2.75 },
        { lat: 36.75289, lng: 3.04205 },
        { lat: 34.85, lng: 5.73333 },
        { lat: 35.00756, lng: 6.04476 },
        { lat: 35.39233, lng: 0.14627 },
        { lat: 36.67634, lng: 3.16134 },
        { lat: 25.08333, lng: 8.63333 },
        { lat: 32.75, lng: -0.58333 },
        { lat: 36.49084, lng: 5.47887 },
        { lat: 23.42139, lng: 5.7625 },
        { lat: 36.9, lng: 7.76667 },
        { lat: 36.244877, lng: 6.532605 },
        { lat: 35.304018, lng: -0.231867 },
        { lat: 36.61352, lng: 5.616528 },
        { lat: 36.516615, lng: 6.351592 },
        { lat: 36.064207, lng: 4.624841 },
        { lat: 36.519414, lng: 2.913075 },
        { lat: 36.66658, lng: 3.046016 },
        { lat: 36.511867, lng: 4.731467 },
        { lat: 36.484167, lng: 4.646667 },
        { lat: 36.448218, lng: 3.308637 },
        { lat: 36.392757, lng: 6.422933 },
        { lat: 36.282725, lng: 4.500661 },
        { lat: 35.274001, lng: -0.77648 },
        { lat: 36.3497, lng: 6.734741 },
        { lat: 36.76261, lng: 5.08521 },
        { lat: 36.32822, lng: 6.582379 },
        { lat: 34.744858, lng: -1.345568 },
        { lat: 36.371891, lng: 6.614215 },
        { lat: 36.289424, lng: 6.686803 },
        { lat: 23.147563, lng: 5.73099 },
        { lat: 36.944883, lng: 6.740523 },
        { lat: 36.69285, lng: 3.054674 },
        { lat: 36.792058, lng: 5.688449 },
        { lat: 36.3097, lng: 4.486586 },
        { lat: 37.077006, lng: 6.501081 },
        { lat: 36.297559, lng: 4.500735 },
        { lat: 36.463162, lng: 4.189779 },
        { lat: 36.282508, lng: 4.501072 },
        { lat: 36.508633, lng: 6.339242 },
        { lat: 36.486098, lng: 4.01851 },
        { lat: 36.510651, lng: 6.335494 },
        { lat: 35.837417, lng: 4.794421 },
        { lat: 36.373568, lng: 4.155985 },
        { lat: 36.524165, lng: 4.382377 },
        { lat: 36.552947, lng: 4.340589 },
        { lat: 36.208563, lng: 4.030493 },
        { lat: 36.617591, lng: 5.089664 },
        { lat: 35.709377, lng: 1.136102 },
        { lat: 34.18981, lng: 2.046656 },
        { lat: 35.643073, lng: 1.174519 },
        { lat: 35.710745, lng: 1.13381 },
        { lat: 35.65928, lng: 1.153984 },
        { lat: 35.803254, lng: 7.393807 },
        { lat: 34.406506, lng: 3.182557 },
        { lat: 34.406349, lng: 3.18552 },
        { lat: 35.140939, lng: 4.02194 },
        { lat: 36.209275, lng: 6.429889 },
        { lat: 36.88504, lng: 8.41314 },
        { lat: 36.3, lng: 2.23333 },
        { lat: 35.2, lng: -0.64139 },
        { lat: 36.47255, lng: 2.80057 },
        { lat: 35.69766, lng: -0.63374 },
        { lat: 32.26426, lng: 3.63698 },
        { lat: 34.88277, lng: -1.31667 },
        { lat: 36.34695, lng: 6.60139 },
        { lat: 35.82611, lng: -0.48333 },
        { lat: 34.86831, lng: 5.87364 },
        { lat: 34.84959, lng: 5.73881 },
        { lat: 36.46968, lng: 2.75027 },
        { lat: 34.88639, lng: -1.31834 },
        { lat: 34.9, lng: -1.03333 },
        { lat: 34.88148, lng: 5.74766 },
        { lat: 36.47159, lng: 2.77433 },
        { lat: 34.525752, lng: 3.447515 },
        { lat: 36.747422, lng: 3.079039 },
        { lat: 36.260871, lng: 6.751732 },
        { lat: 36.361251, lng: 6.697625 },
        { lat: 24.93457, lng: 8.984847 },
        { lat: 36.372606, lng: 4.29259 },
        { lat: 24.955108, lng: 8.998295 },
        { lat: 36.487913, lng: 4.013919 },
        { lat: 36.487399, lng: 4.013543 },
        { lat: 36.611275, lng: 6.732021 },
        { lat: 36.332419, lng: 6.523697 },
        { lat: 36.212925, lng: 6.455694 },
        { lat: 36.345495, lng: 6.526888 },
        { lat: 36.346838, lng: 6.532182 },
        { lat: 36.352202, lng: 6.587598 },
        { lat: 36.273938, lng: 6.555916 },
        { lat: 36.387753, lng: 6.591819 },
        { lat: 36.29613, lng: 6.486297 },
        { lat: 35.134243, lng: 6.314223 },
        { lat: 36.69141, lng: 5.528824 },
        { lat: 33.757183, lng: 1.208887 },
        { lat: 33.759534, lng: 1.209193 },
        { lat: 36.572812, lng: 5.286715 },
        { lat: 33.678406, lng: 2.13538 },
        { lat: 35.891336, lng: 1.619365 },
        { lat: 36.460527, lng: 2.940409 },
        { lat: 36.277077, lng: 6.493156 },
        { lat: 36.31207, lng: 6.728887 },
        { lat: 36.211648, lng: 6.745718 },
        { lat: 34.898819, lng: -0.274811 },
        { lat: 36.586728, lng: 6.484168 },
        { lat: 36.37276, lng: 6.549452 },
        { lat: 36.584829, lng: 6.7417 },
        { lat: 36.517376, lng: 7.702038 },
        { lat: 36.885418, lng: 7.027322 },
        { lat: 36.085201, lng: 3.953082 },
        { lat: 35.049267, lng: 6.168844 },
        { lat: 34.560447, lng: 3.407676 },
        { lat: 34.419086, lng: 3.478316 },
        { lat: 33.759521, lng: 1.210619 },
        { lat: 36.740722, lng: 3.121379 },
        { lat: 36.409174, lng: 7.501494 },
        { lat: 36.806548, lng: 7.605436 },
        { lat: 36.718202, lng: 3.190602 },
        { lat: 35.671944, lng: -0.6425 },
        { lat: 36.2839, lng: 5.411202 },
        { lat: 35.801389, lng: 0.048889 },
        { lat: 36.419759, lng: 5.5122 },
        { lat: 36.492458, lng: 5.528474 },
        { lat: 36.930556, lng: 6.481944 },
        { lat: 36.52012, lng: 5.044986 },
        { lat: 35.616646, lng: -0.576587 },
        { lat: 36.770926, lng: 3.056837 },
        { lat: 36.790611, lng: 3.050589 },
        { lat: 36.696389, lng: 3.082222 },
        { lat: 36.400833, lng: 4.457222 },
        { lat: 26.96724, lng: 1.082864 },
        { lat: 36.816895, lng: 5.770309 },
        { lat: 36.713273, lng: 3.185964 },
        { lat: 36.789702, lng: 3.059691 },
        { lat: 36.283443, lng: 7.872117 },
        { lat: 35.540753, lng: 6.143662 },
        { lat: 35.219164, lng: 4.176755 },
        { lat: 36.712895, lng: 4.338258 },
        { lat: 35.212238, lng: 4.185225 },
        { lat: 36.692617, lng: 2.779345 },
        { lat: 36.71213, lng: 3.182202 },
        { lat: 35.261379, lng: -0.741562 },
        { lat: 35.219528, lng: 4.176846 },
        { lat: 35.988938, lng: 4.39606 },
        { lat: 35.834444, lng: 0.129444 },
        { lat: 35.219185, lng: 4.176711 },
        { lat: 29.751052, lng: 6.731648 },
        { lat: 35.859167, lng: 0.071389 },
        { lat: 34.843142, lng: 5.74612 },
        { lat: 36.742615, lng: 2.942397 },
        { lat: 36.701213, lng: 4.102983 },
        { lat: 36.135886, lng: 7.531531 },
        { lat: 35.714916, lng: -0.607336 },
        { lat: 36.81839, lng: 7.747448 },
        { lat: 35.679538, lng: -0.64439 },
        { lat: 36.800402, lng: 3.23797 },
        { lat: 35.539897, lng: 6.142964 },
        { lat: 36.530819, lng: 4.435528 },
        { lat: 36.786905, lng: 3.571305 },
        { lat: 36.853779, lng: 7.747263 },
        { lat: 36.712937, lng: 4.339087 },
        { lat: 36.769919, lng: 2.961697 },
        { lat: 36.795383, lng: 3.236644 },
        { lat: 35.799722, lng: 0.048056 },
        { lat: 36.127207, lng: 1.245452 },
        { lat: 36.72663, lng: 4.470437 },
        { lat: 36.74788, lng: 3.077585 },
        { lat: 36.791697, lng: 3.601995 },
        { lat: 36.883408, lng: 7.726901 },
        { lat: 36.7475, lng: 2.941111 },
        { lat: 35.737587, lng: -0.538542 },
        { lat: 36.5125, lng: 4.586389 },
        { lat: 36.773082, lng: 3.057293 },
        { lat: 36.747698, lng: 3.077924 },
        { lat: 36.714677, lng: 3.210215 },
        { lat: 36.698844, lng: 3.05048 },
        { lat: 36.713108, lng: 3.185994 },
        { lat: 36.670765, lng: 4.409291 },
        { lat: 36.755998, lng: 3.464333 },
        { lat: 36.622463, lng: 3.521445 },
        { lat: 36.722265, lng: 3.181408 },
        { lat: 36.713277, lng: 3.185969 },
        { lat: 36.761423, lng: 2.86614 },
        { lat: 34.856765, lng: 5.705633 },
        { lat: 30.609289, lng: 8.266219 },
        { lat: 35.919852, lng: 0.066294 },
        { lat: 34.00673, lng: 6.82288 },
        { lat: 36.788708, lng: 3.058903 },
        { lat: 35.106111, lng: -0.334167 },
        { lat: 36.672283, lng: 2.960955 },
        { lat: 36.750704, lng: 3.074122 },
        { lat: 36.579621, lng: 5.871899 },
        { lat: 36.499665, lng: 4.186716 },
        { lat: 35.1936, lng: -1.598804 },
        { lat: 35.255835, lng: 6.204336 },
        { lat: 31.419991, lng: -2.095817 },
        { lat: 36.40122, lng: 6.632241 },
        { lat: 36.513819, lng: 6.676499 },
        { lat: 36.524759, lng: 5.385999 },
        { lat: 35.741008, lng: 4.545681 },
        { lat: 36.800694, lng: 2.976337 },
        { lat: 36.064524, lng: 4.625938 },
        { lat: 36.599174, lng: 4.415424 },
        { lat: 36.505161, lng: 6.454037 },
        { lat: 36.555833, lng: 6.593056 },
        { lat: 36.371944, lng: 6.453056 },
        { lat: 36.73952, lng: 5.727073 },
        { lat: 36.722831, lng: 5.708919 },
        { lat: 36.304726, lng: 6.46085 },
        { lat: 36.443059, lng: 7.310609 },
        { lat: 36.5525, lng: 6.714722 },
        { lat: 36.40482, lng: 6.65302 },
        { lat: 36.717922, lng: 6.192584 },
        { lat: 36.443707, lng: 7.991581 },
        { lat: 31.160214, lng: -2.800454 },
        { lat: 36.53751, lng: 6.617083 },
        { lat: 36.596036, lng: 6.622894 },
        { lat: 37.053889, lng: 7.389722 },
        { lat: 36.545275, lng: 6.623844 },
        { lat: 36.544693, lng: 6.62027 },
        { lat: 37.055767, lng: 7.385962 },
        { lat: 35.127967, lng: 6.284744 },
        { lat: 33.921964, lng: 2.019671 },
        { lat: 36.780678, lng: 5.047386 },
        { lat: 36.304722, lng: 6.461389 },
        { lat: 36.244481, lng: 6.591666 },
        { lat: 36.326903, lng: 6.486576 },
        { lat: 36.551064, lng: 6.589927 },
        { lat: 36.34985, lng: 6.490717 },
        { lat: 36.791184, lng: 5.004428 },
        { lat: 36.780624, lng: 5.047604 },
        { lat: 36.510898, lng: 6.476957 },
        { lat: 36.506329, lng: 6.470431 },
        { lat: 25.404932, lng: 8.424085 },
        { lat: 36.28228, lng: 6.510142 },
        { lat: 36.552429, lng: 6.715079 },
        { lat: 37.060885, lng: 6.518045 },
        { lat: 37.047768, lng: 6.514643 },
        { lat: 36.302395, lng: 6.531093 },
        { lat: 23.869671, lng: 5.909705 },
        { lat: 36.373596, lng: 6.615497 },
        { lat: 36.418133, lng: 6.643253 },
        { lat: 36.750385, lng: 3.012258 },
        { lat: 36.313808, lng: 6.607752 },
        { lat: 36.47036, lng: 6.636182 },
        { lat: 23.851108, lng: 5.910717 },
        { lat: 36.546403, lng: 6.72776 },
        { lat: 22.96402, lng: 5.187493 },
        { lat: 36.761194, lng: 5.084321 },
        { lat: 36.78039, lng: 5.046723 },
        { lat: 36.345812, lng: 6.685671 },
        { lat: 36.310226, lng: 6.614111 },
        { lat: 36.726788, lng: 3.183957 },
        { lat: 36.659595, lng: 5.181261 },
        { lat: 36.198992, lng: 5.367698 },
        { lat: 36.688328, lng: 2.96979 },
        { lat: 36.732751, lng: 2.954564 },
        { lat: 36.817773, lng: 7.715336 },
        { lat: 23.26667, lng: 5.63333 },
        { lat: 36.534316, lng: 1.827729 },
        { lat: 36.750706, lng: 3.080956 },
        { lat: 36.801445, lng: 5.752115 },
        { lat: 36.711444, lng: 3.067881 },
        { lat: 36.205644, lng: 5.41121 },
        { lat: 36.878994, lng: 7.74086 },
        { lat: 36.525471, lng: 2.917917 },
        { lat: 36.80262, lng: 5.753837 },
        { lat: 35.775194, lng: -0.433471 },
        { lat: 36.788865, lng: 4.370485 },
        { lat: 36.526216, lng: 2.862166 },
        { lat: 36.195557, lng: 2.819722 },
        { lat: 36.680634, lng: 4.85756 },
        { lat: 36.521155, lng: 7.702299 },
        { lat: 36.470278, lng: 6.636111 },
        { lat: 36.520245, lng: 7.702623 },
        { lat: 36.701061, lng: 2.859319 },
        { lat: 36.52016, lng: 7.702557 },
        { lat: 36.52027, lng: 7.702795 },
        { lat: 35.449332, lng: 7.12124 },
        { lat: 22.883333, lng: 5.633333 },
        { lat: 36.293993, lng: 6.500829 },
        { lat: 35.9187, lng: 2.753 },
        { lat: 36.66466, lng: 4.77234 },
        { lat: 36.83584, lng: 8.35947 },
        { lat: 36.6434, lng: 4.74493 },
        { lat: 25.81359, lng: 8.13386 },
        { lat: 23.16666, lng: 5.66666 },
        { lat: 35.1488175, lng: 6.2590718 },
        { lat: 33.908107, lng: 1.874177 }
                ]},

            ];
            
            // Create filter controls
            const filterList = document.getElementById('speciesFilterList');
            
            speciesData.forEach((species, index) => {
                const color = colors[index % colors.length];
                speciesColors[species.id] = color; // Store color for this species
                
                // Initialize arrays for this species
                speciesGroups[species.id] = [];
                speciesLabels[species.id] = [];
                
                // Add all points for this species
                species.points.forEach(point => {
                    // Add marker
                    const marker = L.circleMarker([point.lat, point.lng], {
                        radius: 10,
                        fillColor: color,
                        color: '#fff',
                        weight: 1.5,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                    
                    // Add label (only show for one point per species to avoid clutter)
                    if (species.points.indexOf(point) === 0) {
                        const label = L.marker([point.lat, point.lng], {
                            icon: L.divIcon({
                                className: 'map-label',
                                html: species.name,
                                iconSize: null
                            }),
                            interactive: false
                        }).addTo(map);
                        speciesLabels[species.id].push(label);
                    }
                    
                    speciesGroups[species.id].push(marker);
                });
                
                // Add filter checkbox (only one per species)
                const filterItem = document.createElement('div');
                filterItem.className = 'species-filter-item';
                filterItem.innerHTML = `
                    <input type="checkbox" id="filter-${species.id}" checked onchange="toggleSpeciesVisibility('${species.id}', this.checked)">
                    <label for="filter-${species.id}">
                        ${species.name}
                        <span class="status-indicator" style="background-color: ${color}"></span>
                    </label>
                `;
                filterList.appendChild(filterItem);
            });
        });
        
        // Make functions available globally
        window.toggleSpeciesVisibility = toggleSpeciesVisibility;
        window.toggleFilterPanel = toggleFilterPanel;
    </script>
</body>
</html>
